# FMG Calculator Development Rules

## Overview
All calculators must follow consistent patterns for HTML structure, CSS styling, JavaScript logic, and naming conventions to ensure maintainability and user experience consistency.

**These rules strictly adhere to the Global Financial Calculator UI/UX Standards v3.0.**

---

## HTML Structure

### Format Requirements
1. **Single-line HTML**: All HTML must be on a single line with no line breaks (Strict requirement for CMS compatibility).
2. **Structure Order**:
   - `<head>` with CSS link: `<link rel="stylesheet" href="https://fmg-websites-custom.s3.amazonaws.com/calculators/{calculatorName}/styles.css" />`
   - Main wrapper div with body class: `<div class="{prefix}-body ci-body">`
   - Container div: `<div class="{prefix}-container">`
   - Header section: `<div class="{prefix}-header"><p>{subheading text}</p></div>`
   - Calculator layout: `<div class="{prefix}-calculator-layout">`
   - Input section: `<div class="{prefix}-form-column">` with `<!-- Input Section -->` comment
   - Results section: `<div class="{prefix}-results-column">` with `<!-- Results Section -->` comment
   - Scripts at end: Chart.js, jsPDF, and calculator script

### Required Elements
- **Inputs**: Use `type="text"` with `inputmode="numeric"` (for integers/currency) or `inputmode="decimal"` (for percentages).
- **Placeholder format**: Use format like `placeholder="i.e., 10,000"` with 55-60% opacity.
- **Canvas**: Self-closing format: `<canvas id="{prefix}-{name}-chart" />`
- **Chart Toggle**: Include a "Hide Chart" toggle button/link above the chart container.
- **No <form> tags**: Use direct button click handlers and event listeners.
- **Layout**: Form on left (desktop) / top (mobile). Results on right (desktop) / bottom (mobile).

### Scripts (Required)
```html
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://fmg-websites-custom.s3.amazonaws.com/calculators/{calculatorName}/script.js"></script>
```

---

## Naming Conventions

### Prefix System
Each calculator must have a unique prefix (e.g., `hlywml-`, `winw-`, `ira-`). All classes and IDs must use this prefix consistently.

### Required Class Names
- Body: `{prefix}-body ci-body` (CMS automatically adds `.dev-calculator`, do NOT include it manually)
- Container: `{prefix}-container` (Max-width: 1100–1170px)
- Header: `{prefix}-header`
- Input section: `{prefix}-input-section`
- Input group: `{prefix}-input-group`
- Input wrapper: `{prefix}-input-wrapper`
- Currency symbol: `{prefix}-currency`
- Unit symbol: `{prefix}-unit`
- Button group: `{prefix}-button-group`
- Results section: `{prefix}-results-section`
- Chart section: `{prefix}-chart-section`
- Chart toggle: `{prefix}-chart-toggle`
- Chart container: `{prefix}-chart-container`
- Main result: `{prefix}-main-result`
- Main value: `{prefix}-main-value`
- Breakdown: `{prefix}-breakdown`
- Breakdown header: `{prefix}-breakdown-header`
- Breakdown items: `{prefix}-breakdown-items`
- Breakdown item: `{prefix}-breakdown-item`
- Breakdown label: `{prefix}-breakdown-label`
- Breakdown value: `{prefix}-breakdown-value`
- Explanation text: `{prefix}-explanation-text`
- Download section: `{prefix}-download-section`
- Download button: `{prefix}-download-btn` (also include `c-btn` class)
- Start Over button: `{prefix}-start-over-btn` (also include `c-btn` class)
- Tooltip icon: `{prefix}-tooltip` (for '?' icons)

### Slider Classes (when applicable)
- Input group with slider: `{prefix}-input-group {prefix}-has-slider`
- Slider wrapper: `{prefix}-slider-wrapper`
- Slider: `{prefix}-slider`
- Slider labels: `{prefix}-slider-labels`

### Tooltip Classes
- Tooltip icon: `{prefix}-tooltip` (for '?' icons)
- Tooltip container: `{prefix}-tooltip-container`
- Tooltip text: `{prefix}-tooltip-text`

---

## Input Configuration & Formatting

### Global Input Rules
1. **Type**: ALWAYS use `type="text"`. Do not use `type="number"` as it fights formatting logic.
2. **Input Mode**:
   - Currency/Integers: `inputmode="numeric"`
   - Decimals/Percentages: `inputmode="decimal"`
3. **Steppers**: Enable steppers (spinner arrows) on **hover/focus only** for fields where fine-tuning is useful.
4. **Focus Behavior**: Auto-select entire value on focus to allow quick overwriting.

### Currency Inputs
1. **Formatting**: Add commas on `input` and `blur` events (e.g., 10,000).
2. **Parsing**: Use `parseCurrencyValue()` to strip commas/symbols before math.
3. **Validation**: Validate on blur or meaningful edit. Show errors inline.

### Sliders
1. **Requirement**: If a field allows range selection (years, %), pair a text input with a slider.
2. **Syncing**: Bidirectional syncing (Slider updates Input, Input updates Slider).
3. **Mobile**: Sliders must be visible and touch-friendly on mobile.

#### Slider Implementation
**HTML Structure**:
```html
<div class="{prefix}-input-group {prefix}-has-slider">
    <label>
        <div class="{prefix}-input-wrapper">
            <input type="text" id="{prefix}-field" inputmode="decimal" />
            <span class="{prefix}-unit">%</span>
        </div>
    </label>
    <div class="{prefix}-slider-wrapper">
        <input type="range" id="{prefix}-field-slider" class="{prefix}-slider" min="0" max="20" step="0.1" />
        <div class="{prefix}-slider-labels">
            <span>0%</span>
            <span>20%</span>
        </div>
    </div>
</div>
```

**JavaScript**: Sync slider with text input bidirectionally, update on input/change events.

---

## Calculation Pattern

### Pre-filled & Auto-Calculate (Mandatory)
**There is NO "Calculate" button.**

1. **Load State**: Calculator must load with pre-filled example values (defined in PRD/Spreadsheet).
2. **Initial Result**: Results must be visible and calculated immediately on page load.
3. **Disclaimer**: Display "These are example values. Update them to reflect your own situation." near the form.
4. **Re-calculation**: Trigger `calculateAndDisplay()` on every input change.
5. **Debounce**: Use a 250ms–400ms debounce delay on input events to prevent jitter.

### Required Methods
1. **`calculateOnLoad()`**: 
   - Set default values in inputs.
   - Format currency fields with commas.
   - Call `calculateAndDisplay()` immediately.

2. **`calculateAndDisplay()`**:
   - Validate inputs (if invalid, do not update results or show error state).
   - Calculate math.
   - Update HTML DOM elements.
   - Update Chart.

3. **`resetForm()`**:
   - Restores **default example values** (not empty/blank).
   - Re-runs calculation.
   - Scrolls user to top of form (mobile).

---

## Tooltips

### UX Pattern
- **Icon**: Use a '?' icon next to the label.
- **Interaction**: **Click/Tap** to toggle (Not hover). Better for mobile.
- **Content**: Short, plain language. No jargon.

### Implementation
**HTML Structure**:
```html
<label for="{prefix}-field">
    <span>
        Field Label
        <span class="{prefix}-tooltip" data-tooltip="Tooltip explanation text">?</span>
    </span>
</label>
```

**JavaScript**: Make tooltips clickable (not just hover), show/hide on click for mobile compatibility.

---

## Chart Integration

### Chart.js Setup
1. **Expandable Card**: Chart should be in an expandable/collapsible card that starts expanded.
2. **Toggle**: Include a caret/arrow toggle button in the chart header that allows users to collapse/expand the entire chart card.
3. **Header**: Chart heading and toggle should always be visible; only the chart content collapses.
4. **Styling**: Use soft, professional colors (blues, greens). Avoid "alarmist" colors (bright red) unless necessary.
5. **Responsive**: Chart must resize correctly within its container.

### Expandable Chart Card Implementation
**HTML Structure**:
```html
<div class="{prefix}-chart-section">
    <div class="{prefix}-chart-header">
        <h2>Chart Title</h2>
        <button id="{prefix}-chart-toggle" class="{prefix}-chart-toggle" aria-expanded="true">
            <span class="{prefix}-caret"></span>
        </button>
    </div>
    <div class="{prefix}-chart-content">
        <div class="{prefix}-chart-container">
            <canvas id="{prefix}-chart" />
        </div>
    </div>
</div>
```

**CSS for Expandable Card**:
```css
/* Chart header with toggle */
.{prefix}-chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0;
    cursor: pointer;
}

.{prefix}-chart-header h2 {
    margin-bottom: 0;
    flex: 1;
}

/* Toggle button */
.{prefix}-chart-toggle {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    transition: all 0.2s ease;
    font-family: inherit;
    flex-shrink: 0;
}

.{prefix}-chart-toggle:hover {
    background: #f1f5f9;
}

/* CSS caret/arrow (empty triangle) */
.{prefix}-caret {
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 8px solid #64748b;
    transition: transform 0.3s ease;
    display: block;
}

.{prefix}-chart-section.collapsed .{prefix}-caret {
    transform: rotate(180deg);
}

.{prefix}-chart-toggle:hover .{prefix}-caret {
    border-bottom-color: #475569;
}

/* Chart content (collapsible) */
.{prefix}-chart-content {
    margin-top: 20px;
    overflow: hidden;
    max-height: 1000px;
    opacity: 1;
    transition: max-height 0.3s ease, opacity 0.3s ease, margin-top 0.3s ease;
}

.{prefix}-chart-section.collapsed .{prefix}-chart-content {
    max-height: 0;
    margin-top: 0;
    opacity: 0;
    overflow: hidden;
}
```

**JavaScript Implementation**:
```javascript
toggleChart() {
    if (!this.chartSection || !this.chartToggle) return;
    
    const isCollapsed = this.chartSection.classList.contains('collapsed');
    
    if (isCollapsed) {
        // Expand
        this.chartSection.classList.remove('collapsed');
        this.chartToggle.setAttribute('aria-expanded', 'true');
    } else {
        // Collapse
        this.chartSection.classList.add('collapsed');
        this.chartToggle.setAttribute('aria-expanded', 'false');
    }
}
```

**Behavior**:
- **Initial state**: Chart card starts expanded with caret pointing up (▲)
- **Caret rotation**: Rotates 180° when collapsed (points down ▼)
- **Smooth transitions**: CSS transitions for rotation and content collapse/expand
- **Hover effects**: Caret color changes on hover
- **Clickable header**: Entire header is clickable to toggle, not just the button
- **Accessibility**: Uses `aria-expanded` attribute for screen readers

---

## Result Display

### Hierarchy
1. **Headline**: Main result (e.g., "You will save $4,000").
2. **Interpretation**: One sentence explaining the headline.
3. **Chart**: Visual representation (with toggle).
4. **Breakdown**: Detailed numbers (nested below).

### Breakdown Section
- **Divider**: Use `border-top: 1px solid #e2e8f0` (no separate cards).
- **Spacing**: `margin-top: 24px`, `padding-top: 24px`.

---

## CSS Patterns

### Typography
- **Inheritance**: Do NOT set global `font-family` or base `font-size`. Inherit from host site.
- **Overrides**: Only use specific sizes/weights for Headlines, Breakdown Values, and Chart Titles for hierarchy.

### Layout
```css
/* Ensure container is not constrained to article width */
.{prefix}-container {
    max-width: 1150px; /* 1100-1170px range */
    margin: 0 auto;
    width: 100%;
}
```

### Card Spacing (Consistent Rules)
All content cards (form columns, result cards, breakdown sections, chart sections, etc.) must follow consistent spacing:

```css
.{prefix}-card {
    padding: 26px;
    margin-bottom: 24px;
    /* Do NOT declare margin-top - it should be 0 by default */
}
```

**Rules:**
- **Padding**: Always `26px` for all cards
- **Margin-bottom**: `24px` for all cards
- **Margin-top**: Do NOT declare (should be 0 by default)
- **Last card exception**: The card immediately above the download button should have `margin-bottom: 32px;` to create extra space before the download button

**Example:**
```css
.{prefix}-form-column,
.{prefix}-main-result,
.{prefix}-breakdown {
    padding: 26px;
    margin-bottom: 24px;
}

.{prefix}-chart-section {
    /* Last card before download button */
    padding: 26px;
    margin-bottom: 32px;
}
```

### Steppers (Hover Only)
```css
/* Hide by default */
.{prefix}-input-wrapper input::-webkit-outer-spin-button,
.{prefix}-input-wrapper input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

/* Show on hover/focus */
.{prefix}-input-wrapper input:hover::-webkit-outer-spin-button,
.{prefix}-input-wrapper input:hover::-webkit-inner-spin-button,
.{prefix}-input-wrapper input:focus::-webkit-outer-spin-button,
.{prefix}-input-wrapper input:focus::-webkit-inner-spin-button {
    -webkit-appearance: auto;
}
```

### Buttons
- **Download Button**: Only for PDF. No Print. No CSV.
- **Start Over Button**: Must reset to defaults.

---

## JavaScript Class Structure

```javascript
class {CalculatorName}Calculator {
    constructor() {
        // Default values (Required)
        this.defaultValues = {
            '{prefix}-input-1': '10000',
            '{prefix}-input-2': '5.5'
        };
        
        this.init();
    }
    
    init() {
        this.cacheDOM();
        this.initializeInputFormatting();
        this.initializeSliders();
        this.initializeEventListeners();
        this.initializeChart();
        this.calculateOnLoad(); // Immediate calculation
    }
    
    initializeEventListeners() {
        // Real-time calculation with debounce
        this.inputs.forEach(input => {
            input.addEventListener('input', (e) => {
                this.handleInput(e); // Formatting + Debounced Calculation
            });
            
            input.addEventListener('blur', (e) => {
                this.formatOnBlur(e);
                this.calculateAndDisplay(); // Immediate update on blur
            });
        });
        
        // Start Over
        this.resetBtn.addEventListener('click', () => this.resetForm());
        
        // Chart Toggle
        this.chartToggle.addEventListener('click', () => this.toggleChart());
    }
    
    // ... calculation methods
}
```

---

## Required JavaScript Methods

### `initializeInputFormatting()`
- Change currency inputs to `type="text"` (if not already)
- Add event listeners: `input`, `blur`, `focus`
- Format with commas on input/blur
- Remove commas on focus for easier editing

### `formatCurrencyInput(event)`
- Strip non-numeric characters
- Add comma formatting
- Update input value

### `handleCurrencyFocus(event)`
- Auto-select entire value on focus
- Remove commas when input is focused for easier editing

### `parseCurrencyValue(value)`
- Strip all non-numeric characters (commas, dollar signs, etc.)
- Return numeric value for calculations

### `initializeSliders()`
- Set up bidirectional sync between sliders and text inputs
- Update text input when slider changes
- Update slider when text input changes
- Validate and cap values appropriately

### `getFormData()`
- Use `parseCurrencyValue()` for currency inputs
- Return object with all form values

### `toggleChart()`
- Show/hide chart container
- Update toggle button text ("Hide Chart" / "Show Chart")

---

## Responsive Design

### Media Queries
- Use consistent breakpoints across all calculators
- Test on mobile, tablet, and desktop
- Ensure inputs, results, and charts are readable on all screen sizes

### Common Patterns
- Stack form and results columns on mobile
- Adjust font sizes for readability
- Ensure buttons are easily tappable on mobile (44px minimum touch target)

### Mobile Scrolling Behavior
- **Start Over button**: Auto-scroll users up to the form
- **View Results button** (if used): Auto-scroll users down to the results
- **Sticky container**: For one/two central outputs, show sticky container at bottom that auto-completes when users edit data

---

## CMS Compatibility

### Critical Rules
1. **Do NOT include `.dev-calculator` class**: CMS automatically adds it
2. **Single-line HTML**: Required for CMS parsing
3. **No line breaks in HTML**: All HTML must be on one line
4. **CDN links**: Use full CDN URLs for scripts and stylesheets
5. **Self-closing tags**: Use self-closing format for canvas and similar elements

### Checklist
1. **Single Line**: Is the HTML minified to one line?
2. **No .dev-calculator**: Did you omit the `.dev-calculator` class?
3. **Prefix**: Are all classes unique to this calculator?
4. **Assets**: Are CSS/JS links pointing to the correct S3/CDN URLs?

---

## Testing Checklist

Before considering a calculator complete:
- [ ] All inputs pre-filled with default values
- [ ] Results display on page load (auto-calculated)
- [ ] Real-time calculation works on input changes (debounced 250-400ms)
- [ ] Currency inputs format with commas
- [ ] Steppers appear on hover/focus only (if applicable)
- [ ] Sliders sync bidirectionally with text inputs
- [ ] Start Over button restores defaults and scrolls to form (mobile)
- [ ] Chart displays correctly with appropriate colors
- [ ] Chart toggle works ("Hide Chart" / "Show Chart")
- [ ] Chart updates when inputs change
- [ ] Tooltips work on click/tap (mobile-friendly)
- [ ] Responsive design works on mobile/tablet/desktop
- [ ] All classes use consistent prefix
- [ ] HTML is single-line format
- [ ] Breakdown section styled correctly (nested in main result, divider instead of border)
- [ ] Download Results button works (PDF only, no print)
- [ ] Disclaimer displayed: "These are example values. Update them to reflect your own situation."
- [ ] Typography inherits from host site (no global font-family/font-size)
- [ ] Container max-width: 1100-1170px
- [ ] Focus behavior: Auto-select entire value on focus

---

## Examples

### Calculator Prefixes Used
- `hlywml-`: How Long Will Your Money Last
- `winw-`: What Is My Net Worth
- `ira-`: Contributing to an IRA
- `wimb-`: What Is My Monthly Budget
- `doi-`: Debt or Invest
- `sfc-`: Saving for College
- `ci-`: Comparing Investments

### File Structure
```
{calculator-name}/
  ├── index.html (single-line HTML)
  ├── styles.css
  └── script.js
```

---

## Download Results

### PDF Download Only
- **Download button**: Only include "Download Results" button (PDF download)
- **No print option**: Do not include print functionality
- **No CSV export**: Do not include CSV export functionality
- **Implementation**: Use jsPDF library to generate PDF from results

---

## Notes

- Always test calculators in the CMS environment
- Keep color palettes soft and professional
- Ensure calculations are accurate and match expected financial formulas
- Maintain consistency with existing calculators for user experience
- Document any deviations from these rules with clear reasoning
- **Pre-filled forms are mandatory**: All calculators must load with pre-filled example values
- **Mobile-first considerations**: Ensure all interactions work well on mobile devices
- **Follow UI/UX Standards v3.0**: These rules align with the Global Financial Calculator UI/UX Standards
