# FMG Calculator Development Rules

## Overview
All calculators must follow consistent patterns for HTML structure, CSS styling, JavaScript logic, and naming conventions to ensure maintainability and user experience consistency.

---

## HTML Structure

### Format Requirements
1. **Single-line HTML**: All HTML must be on a single line with no line breaks (required for CMS compatibility)
2. **Structure Order**:
   - `<head>` with CSS link: `<link rel="stylesheet" href="https://fmg-websites-custom.s3.amazonaws.com/calculators/{calculatorName}/styles.css" />`
   - Main wrapper div with body class: `<div class="{prefix}-body ci-body">`
   - Container div: `<div class="{prefix}-container">`
   - Header section: `<div class="{prefix}-header"><p>{subheading text}</p></div>`
   - Calculator layout: `<div class="{prefix}-calculator-layout">`
   - Input section: `<div class="{prefix}-form-column">` with `<!-- Input Section -->` comment
   - Results section: `<div class="{prefix}-results-column">` with `<!-- Results Section -->` comment
   - Scripts at end: Chart.js, jsPDF, and calculator script

### Required Elements
- **Inputs**: Use `type="number"` with `value` attributes for pre-filled data, or `type="text"` with `placeholder` attributes for empty fields
- **Placeholder format**: Use format like `placeholder="i.e., $10,000"` (not just numbers)
- **Canvas**: Self-closing format: `<canvas id="{prefix}-{name}-chart" />`
- **Comments**: Use HTML comments like `<!-- Input Section -->` and `<!-- Results Section -->` for organization
- **No form tags**: Use direct button click handlers, not form submissions
- **Layout**: Form on left, results on right (natural visual hierarchy)

### Scripts (Required)
```html
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://fmg-websites-custom.s3.amazonaws.com/calculators/{calculatorName}/script.js"></script>
```

---

## Naming Conventions

### Prefix System
Each calculator must have a unique prefix (e.g., `hlywml-`, `winw-`, `ira-`, `wimb-`). All classes and IDs must use this prefix consistently.

### Required Class Names
- Body: `{prefix}-body ci-body` (note: CMS automatically adds `.dev-calculator`, do NOT include it)
- Container: `{prefix}-container`
- Header: `{prefix}-header`
- Input section: `{prefix}-input-section`
- Input group: `{prefix}-input-group`
- Input wrapper: `{prefix}-input-wrapper`
- Currency symbol: `{prefix}-currency`
- Unit symbol: `{prefix}-unit`
- Button group: `{prefix}-button-group`
- Reset button: `{prefix}-reset-btn` (also include `c-btn` class)
- Results section: `{prefix}-results-section`
- Chart section: `{prefix}-chart-section`
- Chart heading: `{prefix}-chart-heading`
- Chart container: `{prefix}-chart-container`
- Main result: `{prefix}-main-result`
- Main value: `{prefix}-main-value`
- Breakdown: `{prefix}-breakdown`
- Breakdown header: `{prefix}-breakdown-header`
- Breakdown items: `{prefix}-breakdown-items`
- Breakdown item: `{prefix}-breakdown-item`
- Breakdown label: `{prefix}-breakdown-label`
- Breakdown value: `{prefix}-breakdown-value`
- Explanation text: `{prefix}-explanation-text`
- Download section: `{prefix}-download-section`
- Download button: `{prefix}-download-btn` (also include `c-btn` class)
- Tooltip icon: `{prefix}-tooltip` (for '?' icons)
- Calculate button: `{prefix}-calculate-btn` (only for empty forms)
- Start Over button: `{prefix}-start-over-btn` (alternative to reset)

### Slider Classes (when applicable)
- Input group with slider: `{prefix}-input-group {prefix}-has-slider`
- Slider wrapper: `{prefix}-slider-wrapper`
- Slider: `{prefix}-slider`
- Slider labels: `{prefix}-slider-labels`

### Tooltip Classes
- Tooltip icon: `{prefix}-tooltip` (for '?' icons)
- Tooltip container: `{prefix}-tooltip-container`
- Tooltip text: `{prefix}-tooltip-text`

---

## Tooltips vs Helper Text

### UX Recommendation: Tooltips (Preferred)
- **Use clickable tooltips**: Use '?' icons with clickable tooltips (better mobile experience)
- **Reasoning**: Reduces visual clutter and performs better on mobile
- **Avoid**: Persistent helper text under fields (makes forms too long)

### Implementation
1. **HTML Structure**:
   ```html
   <label for="{prefix}-field">
       <span>
           Field Label
           <span class="{prefix}-tooltip" data-tooltip="Tooltip explanation text">?</span>
       </span>
   </label>
   ```

2. **JavaScript**:
   - Make tooltips clickable (not just hover)
   - Show/hide on click for mobile compatibility
   - Position tooltips appropriately

3. **CSS**:
   - Style '?' icon consistently
   - Ensure tooltips are readable on mobile
   - Position tooltips to avoid overlapping content

---

## Dropdowns vs Text Fields

### When to Use Dropdowns
- **Precise selections**: Use for options with limited choices
- **Limit**: No more than 10 values to limit scrolling
- **Examples**: Tax filing status, yes/no questions, predefined categories

### When to Use Text Fields
- **Precise values**: Any value that needs to be precise (dollar amounts, percentages, years)
- **Flexibility**: When users need to enter custom values
- **Examples**: Income amounts, contribution amounts, years

### Implementation
- **Dropdowns**: Use `<select>` elements with `<option>` values
- **Text fields**: Use `<input type="text">` or `<input type="number">` based on formatting needs

---

## Input Formatting

### Currency Inputs
1. **Type**: Change to `type="text"` (not `type="number"`) to allow comma formatting
2. **Formatting**: Add commas on `input` and `blur` events
3. **Focus**: Remove commas on `focus` for easier editing
4. **Parsing**: Use `parseCurrencyValue()` method to strip commas before calculations
5. **Default values**: Format with commas on page load
6. **No steppers**: Text inputs don't have steppers (up/down arrows), which is intentional per UX recommendations

### Percentage/Number Inputs with Sliders
1. **Type**: Keep as `type="number"`
2. **CSS**: Add `appearance: textfield` to remove spinner arrows (UX does not recommend steppers)
3. **Positioning**: Unit symbol positioned at `right: 12px`
4. **No steppers**: Remove spinner arrows via CSS - UX does not recommend up/down arrow steppers as they introduce inaccuracy

### Currency Symbol Positioning
- Currency symbol (`$`): Positioned inside input wrapper
- Unit symbol (`%`, `years`, etc.): Positioned at `right: 12px` (not `45px`)

### Flexible Inputs ($ vs %)
- **When applicable**: Offer flexibility to enter either dollar amount or percentage for the same field
- **Example**: Mortgage down payment can be entered as $20,000 or 20%
- **Implementation**: Provide toggle or dual input fields when this flexibility adds value

---

## Calculation Pattern

### Pre-filled Forms (Preferred)
- **Auto-calculate**: When forms are pre-filled with data, results should auto-calculate on page load
- **Real-time updates**: Auto-calculate on every input change (debounced)
- **No calculate button**: Remove calculate buttons for pre-filled forms
- **Results display**: Show calculated results immediately on page load

### Empty Forms (Alternative)
- **Calculate button required**: When forms start empty, use a "Calculate" button to prevent showing errors while user is still inputting
- **Button behavior**: 
  - Desktop: Calculate button triggers calculation
  - Mobile: Calculate button auto-scrolls to results section after calculation
- **Validation**: Only show results after user clicks calculate and all required fields are valid

### Required Methods
1. **`calculateOnLoad()`**: 
   - Format initial currency values with commas (if pre-filled)
   - Trigger `calculateAndDisplay()` (if pre-filled)
   - Called in constructor after initialization

2. **`calculateAndDisplay()`**:
   - Check if inputs are valid
   - Get form data
   - Calculate results
   - Display results and update chart
   - Debounced with 300ms timeout for input events (pre-filled forms)

3. **Event Listeners** (Pre-filled forms):
   - All inputs: `input` event with debounced `calculateAndDisplay()`
   - All inputs: `blur` event with immediate `calculateAndDisplay()`
   - Selects/dropdowns: `change` event with `calculateAndDisplay()`

4. **Calculate Button** (Empty forms):
   - Validate all inputs before calculating
   - Show errors for invalid/empty required fields
   - On mobile: Auto-scroll to results section after calculation

---

## Default Values & Placeholders

### Pre-filled Data (Preferred)
1. **Store defaults**: Create `defaultValues` object in constructor
2. **Pre-fill inputs**: All inputs should have `value` attributes with defaults
3. **Format on load**: Currency defaults formatted with commas in `calculateOnLoad()`
4. **Auto-calculate**: Results display automatically when form is pre-filled
5. **Disclaimers**: If using national averages, add disclaimer that these are hypothetical averages

Example:
```javascript
this.defaultValues = {
    '{prefix}-input-1': '10000',
    '{prefix}-input-2': '5000'
};
```

### Empty Fields with Placeholders (Alternative)
1. **Use placeholders**: When pre-filling isn't possible, use `placeholder` attributes
2. **Placeholder format**: Use format like `placeholder="i.e., $10,000"` (not just numbers)
3. **No zeros**: UX does NOT recommend using zeros as default values
4. **Calculate button**: Empty forms require a "Calculate" button

### Handling Averages
- **Disclaimers**: Must add disclaimer when using national/regional averages
- **Advanced option**: Consider allowing users to enter data manually OR provide zip code for local average

---

## Reset / Start Over Button

### Requirements
1. **Class**: `c-btn {prefix}-reset-btn` or `c-btn {prefix}-start-over-btn`
2. **ID**: `{prefix}-reset-btn` or `{prefix}-start-over-btn`
3. **Label**: Use "Start Over" after calculation (preferred) or "Reset"
4. **Functionality**:
   - Reset all inputs to `defaultValues` (or show placeholders with original data in format "i.e. $10,000")
   - Format currency values with commas
   - Clear any error messages
   - Zero out results panel (show $0 or empty state)
   - On mobile: Auto-scroll users up to the form
5. **Styling**: `min-width: 200px`, positioned with `justify-content: flex-start` in button group

### Mobile Behavior
- **Start Over button**: Auto-scrolls users up to the form
- **View Results button** (if used): Auto-scrolls users down to the results
- **Sticky container**: If there's one/two central outputs, show sticky container at bottom that auto-completes when users edit data

---

## Sliders

### When to Use
- Percentage fields (rate of return, inflation rate, etc.)
- Year/number fields where range selection is helpful
- **Always pair with text input**: Users need both precision (typing) and tactile (sliding) options

### Implementation
1. **HTML Structure**:
   ```html
   <div class="{prefix}-input-group {prefix}-has-slider">
       <label>
           <div class="{prefix}-input-wrapper">
               <input type="number" id="{prefix}-field" />
               <span class="{prefix}-unit">%</span>
           </div>
       </label>
       <div class="{prefix}-slider-wrapper">
           <input type="range" id="{prefix}-field-slider" class="{prefix}-slider" min="0" max="20" step="0.1" />
           <div class="{prefix}-slider-labels">
               <span>0%</span>
               <span>20%</span>
           </div>
       </div>
   </div>
   ```

2. **JavaScript**:
   - Sync slider with text input bidirectionally
   - Update text input when slider changes
   - Update slider when text input changes
   - Validate and cap values appropriately

3. **CSS**:
   - Remove spinner arrows: `appearance: textfield` on number inputs
   - Style slider thumb and track consistently
   - Position unit symbol at `right: 12px`

4. **Platform Support**:
   - Use sliders for both desktop and mobile
   - Ensure sliders are easily usable on touch devices

---

## Chart Integration

### Chart.js Setup
1. **Include CDN**: Chart.js script must be included
2. **Canvas**: Self-closing `<canvas id="{prefix}-{name}-chart" />`
3. **Container**: `<div class="{prefix}-chart-container">` wrapping canvas
4. **Heading**: `<h2 class="{prefix}-chart-heading">{Chart Title}</h2>`

### Chart Styling
- **Colors**: Use soft, muted colors (avoid black/red)
- **Examples**: Soft blues, greens, corals
- **Hardcode colors**: If CSS variables don't work, hardcode colors in JavaScript (e.g., `'#10b981'` for green)

### Chart Methods
- **`initializeChart()`**: Create chart instance on page load
- **`updateChart()`**: Update chart data when inputs change
- **`generateChart()`**: Generate chart with results data

---

## Result Display

### Main Result Card
- **Class**: `{prefix}-main-result`
- **Structure**:
  ```html
  <div class="{prefix}-main-result">
      <h2>{Result Title}</h2>
      <div class="{prefix}-main-value" id="{prefix}-result-value">$0</div>
      <div class="{prefix}-breakdown">
          <!-- Breakdown content -->
      </div>
  </div>
  ```

### Breakdown Section
- **Nested in main result**: Breakdown should be inside main result card (not separate card)
- **Divider**: Use `border-top: 1px solid #e2e8f0` instead of separate card border
- **Spacing**: `margin-top: 24px`, `padding-top: 24px`
- **Structure**:
  ```html
  <div class="{prefix}-breakdown">
      <div class="{prefix}-breakdown-header">
          <h3>Breakdown</h3>
      </div>
      <div class="{prefix}-breakdown-items">
          <div class="{prefix}-breakdown-item">
              <div class="{prefix}-breakdown-label">Label</div>
              <div class="{prefix}-breakdown-value">$0</div>
          </div>
      </div>
  </div>
  ```

### Typography
- **Breakdown values**: `font-size: 1rem` (match paragraph size), `font-weight: 600` (bold)
- **Main value**: Larger, prominent display

---

## CSS Patterns

### Required Styles

#### Reset Button
```css
.{prefix}-reset-btn {
    min-width: 200px;
    /* Additional button styles */
}
```

#### Button Group
```css
.{prefix}-button-group {
    justify-content: flex-start;
    align-items: flex-start;
}
```

#### Unit/Currency Positioning
```css
.{prefix}-unit {
    right: 12px; /* Not 45px */
}

.{prefix}-currency {
    /* Positioned inside input wrapper */
}
```

#### Chart Heading
```css
.{prefix}-chart-heading {
    text-align: center;
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    letter-spacing: -0.02em;
    color: #1a202c;
}
```

#### Breakdown Styling
```css
.{prefix}-breakdown {
    margin-top: 24px;
    padding-top: 24px;
    border-top: 1px solid #e2e8f0;
}

.{prefix}-breakdown-value {
    font-size: 1rem;
    font-weight: 600;
}
```

#### Slider Input Styling
```css
.{prefix}-input-group.{prefix}-has-slider input[type="number"] {
    appearance: textfield; /* Remove spinner arrows */
}

.{prefix}-input-group.{prefix}-has-slider input[type="number"]::-webkit-inner-spin-button,
.{prefix}-input-group.{prefix}-has-slider input[type="number"]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
}
```

### Disabled Button Hover States
For calculate buttons (if needed in future), use this pattern:
```css
.{prefix}-calculate-btn:hover {
    /* Override CMS hover styles when disabled */
    background: #cccccc !important;
    color: #666666 !important;
    border-color: #cccccc !important;
    box-shadow: none !important;
    transform: none !important;
    opacity: 0.5 !important;
    cursor: not-allowed !important;
}
```

---

## JavaScript Patterns

### Class Structure
```javascript
class {CalculatorName}Calculator {
    constructor() {
        // Cache DOM elements
        this.resultsSection = document.getElementById('{prefix}-results-section');
        this.resetBtn = document.getElementById('{prefix}-reset-btn');
        this.chartContainer = document.querySelector('.{prefix}-chart-container');
        this.chartInstance = null;
        
        // Default values
        this.defaultValues = {
            '{prefix}-input-1': 'value1',
            '{prefix}-input-2': 'value2'
        };
        
        // Calculation timeout for debouncing
        this.calculationTimeout = null;
        
        // Initialize
        this.initializeInputFormatting();
        this.initializeSliders(); // If applicable
        this.initializeEventListeners();
        this.calculateOnLoad();
    }
}
```

### Required Methods

#### `initializeInputFormatting()`
- Change currency inputs to `type="text"`
- Add event listeners: `input`, `blur`, `focus`
- Format with commas on input/blur
- Remove commas on focus

#### `formatCurrencyInput(event)`
- Strip non-numeric characters
- Add comma formatting
- Update input value

#### `handleCurrencyFocus(event)`
- Remove commas when input is focused
- Allow easier editing

#### `parseCurrencyValue(value)`
- Strip all non-numeric characters (commas, dollar signs, etc.)
- Return numeric value for calculations

#### `calculateOnLoad()`
- Format initial currency values with commas
- Trigger `calculateAndDisplay()`

#### `calculateAndDisplay()`
- Check `hasValidInputs()`
- Get form data with `getFormData()`
- Calculate results with `calculateResults()`
- Display results with `displayResults()`
- Update chart

#### `getFormData()`
- Use `parseCurrencyValue()` for currency inputs
- Return object with all form values

#### `resetForm()`
- Reset all inputs to `defaultValues`
- Format currency values with commas
- Clear errors
- Call `calculateAndDisplay()`

### Event Listener Pattern
```javascript
initializeEventListeners() {
    // Reset button
    if (this.resetBtn) {
        this.resetBtn.addEventListener('click', () => this.resetForm());
    }
    
    // Real-time calculation on all inputs
    const inputs = document.querySelectorAll('input');
    inputs.forEach(input => {
        input.addEventListener('input', () => {
            this.clearError(input);
            this.validateAndCapInput(input);
            clearTimeout(this.calculationTimeout);
            this.calculationTimeout = setTimeout(() => {
                this.calculateAndDisplay();
            }, 300);
        });
        
        input.addEventListener('blur', () => {
            this.validateAndCapInput(input);
            this.calculateAndDisplay();
        });
    });
    
    // Dropdowns/selects
    const selects = document.querySelectorAll('select');
    selects.forEach(select => {
        select.addEventListener('change', () => this.calculateAndDisplay());
    });
}
```

---

## CMS Compatibility

### Critical Rules
1. **Do NOT include `.dev-calculator` class**: CMS automatically adds it
2. **Single-line HTML**: Required for CMS parsing
3. **No line breaks in HTML**: All HTML must be on one line
4. **CDN links**: Use full CDN URLs for scripts and stylesheets
5. **Self-closing tags**: Use self-closing format for canvas and similar elements

---

## Responsive Design

### Media Queries
- Use consistent breakpoints across all calculators
- Test on mobile, tablet, and desktop
- Ensure inputs, results, and charts are readable on all screen sizes

### Common Patterns
- Stack form and results columns on mobile
- Adjust font sizes for readability
- Ensure buttons are easily tappable on mobile

### Mobile Scrolling Behavior
- **Calculate button** (empty forms): Auto-scroll to results section after calculation
- **Start Over button**: Auto-scroll users up to the form
- **View Results button** (if used): Auto-scroll users down to the results
- **Sticky container**: For one/two central outputs, show sticky container at bottom that auto-completes when users edit data

---

## Code Quality

### CSS
- Remove unused rulesets and empty selectors
- Consolidate duplicate rules
- Use consistent spacing and formatting
- Comment complex or non-obvious styles

### JavaScript
- Use consistent method naming
- Add comments for complex calculations
- Handle edge cases (empty inputs, invalid values, etc.)
- Validate and cap inputs appropriately

### HTML
- Keep structure consistent across calculators
- Use semantic HTML where possible
- Ensure accessibility (labels, ARIA attributes if needed)

---

## Testing Checklist

Before considering a calculator complete:
- [ ] All inputs pre-filled with default values (or placeholders if pre-fill not possible)
- [ ] Results display on page load (if pre-filled) OR calculate button works (if empty)
- [ ] Real-time calculation works on input changes (pre-filled forms)
- [ ] Currency inputs format with commas
- [ ] Start Over/Reset button restores defaults and zeroes results
- [ ] Chart displays correctly with appropriate colors
- [ ] Chart updates when inputs change
- [ ] Responsive design works on mobile/tablet/desktop
- [ ] Mobile scrolling behavior works (auto-scroll to results/form)
- [ ] All classes use consistent prefix
- [ ] HTML is single-line format
- [ ] Tooltips implemented (if needed) instead of persistent helper text
- [ ] No steppers (spinner arrows) on inputs
- [ ] Breakdown section styled correctly (nested in main result, divider instead of border)
- [ ] Download Results button works (PDF only, no print)
- [ ] Disclaimers added if using national/regional averages

---

## Examples

### Calculator Prefixes Used
- `hlywml-`: How Long Will Your Money Last
- `winw-`: What Is My Net Worth
- `ira-`: Contributing to an IRA
- `wimb-`: What Is My Monthly Budget

### File Structure
```
{calculator-name}/
  ├── index.html (single-line HTML)
  ├── styles.css
  └── script.js
```

---

## Download Results

### PDF Download Only
- **Download button**: Only include "Download Results" button (PDF download)
- **No print option**: Do not include print functionality
- **Implementation**: Use jsPDF library to generate PDF from results

---

## Notes

- Always test calculators in the CMS environment
- Keep color palettes soft and professional
- Ensure calculations are accurate and match expected financial formulas
- Maintain consistency with existing calculators for user experience
- Document any deviations from these rules with clear reasoning
- **Pre-filled forms are preferred**: Always try to pre-fill forms with realistic default values
- **Mobile-first considerations**: Ensure all interactions work well on mobile devices

